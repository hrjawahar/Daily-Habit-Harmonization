<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>zenifyMove ‚Äî A movement awareness engine</title>
<style>
  :root {
    --bg:#ffffff;
    --ink:#0b0b12;
    --muted:#4b5563;
    --muted2:#6b7280;
    --card:#ffffff;
    --border:rgba(15, 23, 42, .12);
    --shadow:0 18px 50px rgba(2, 6, 23, .10);
    --r:20px;

    --purple:#2e0b5e;
    --purple2:#5b21b6;
    --neon:#00e5ff;

    --cta:#111827;
    --ctaText:#ffffff;

    --good:rgba(0,229,255,.10);
    --goodBorder:rgba(0,229,255,.45);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: var(--bg);
    color: var(--ink);
    padding: 22px;
  }
  .wrap{max-width: 920px; margin: 0 auto;}
  header{
    display:flex; justify-content:space-between; align-items:center; gap:12px;
    margin-bottom:14px; flex-wrap:wrap;
  }
  .brand{display:flex; gap:12px; align-items:center}
  .logo{
    width:44px;height:44px;border-radius:16px;
    background:
      radial-gradient(16px 16px at 65% 35%, rgba(0,229,255,.95), transparent 60%),
      linear-gradient(135deg, rgba(46,11,94,1), rgba(91,33,182,1));
    box-shadow: 0 10px 28px rgba(91,33,182,.22);
    display:grid; place-items:center;
    border:1px solid rgba(0,229,255,.35);
  }
  .logo span{filter: drop-shadow(0 6px 10px rgba(0,229,255,.25));}
  .title h1{font-size:18px;margin:0}
  .title p{margin:2px 0 0; color:var(--muted2); font-size:12.5px}
  .topnav{display:flex; gap:8px; flex-wrap:wrap}
  .topnav button{
    border:1px solid var(--border);
    background:#fff;
    color:var(--ink);
    padding:9px 10px;
    border-radius:999px;
    cursor:pointer;
    font-weight:800;
    font-size:12.5px;
  }
  .topnav button.active{
    border-color: rgba(0,229,255,.55);
    box-shadow: 0 10px 26px rgba(0,229,255,.10);
  }

  .card{
    background: var(--card);
    border:1px solid var(--border);
    border-radius: var(--r);
    box-shadow: var(--shadow);
  }
  .card-inner{padding:18px}
  .hr{height:1px;background:rgba(15,23,42,.08); margin:14px 0}
  .screen{display:none}
  .screen.active{display:block}

  .hero-title{
    font-size: 34px;
    line-height: 1.1;
    letter-spacing: -0.7px;
    margin: 0;
    font-weight: 950;
  }
  .hero-sub{
    margin: 10px 0 0;
    font-size: 16px;
    line-height: 1.5;
    color: var(--muted);
    max-width: 76ch;
  }
  .hand{font-family: "Comic Sans MS","Segoe Print","Bradley Hand",cursive; color: var(--neon); font-weight: 900;}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(0,229,255,.45); background:rgba(0,229,255,.06); font-size:12px; color: #0b1220; font-weight:900;}
  .pill b{color: var(--purple2)}

  .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top: 16px; align-items:center}
  button{
    border:1px solid var(--border);
    background:#fff;
    color:var(--ink);
    padding:11px 14px;
    border-radius:16px;
    cursor:pointer;
    font-weight: 900;
  }
  .cta{
    background: var(--cta);
    color: var(--ctaText);
    border-color: rgba(17,24,39,.85);
    box-shadow: 0 14px 30px rgba(17,24,39,.14);
  }
  .cta:hover{transform: translateY(-1px)}
  button:disabled{opacity:.45; cursor:not-allowed}

  .tiny{font-size:12.5px; color: var(--muted2)}
  .subtle{color: var(--muted2); font-size:12.5px; margin-top:10px}
  .proof{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:14px;}
  .proof .box{border:1px solid rgba(0,229,255,.28); background: rgba(0,229,255,.05); border-radius:16px; padding:10px 12px; font-size:12.5px; color:#0b1220;}
  .proof .quote{border-color: rgba(91,33,182,.22); background: rgba(91,33,182,.04); color: #111827}

  .badge{display:inline-flex; align-items:center; gap:8px; padding:7px 10px; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:12px; color:var(--muted2); font-weight:800;}
  .lockline{display:flex; align-items:center; gap:8px; color: var(--muted2); font-size:12.5px; margin-top:10px}

  .list{margin:10px 0 0 18px; color:var(--muted); line-height:1.65}

  /* Setup */
  .setupTop{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-start}
  .cluster{border:1px solid var(--border); border-radius:18px; padding:12px; background:#fff; margin-top:10px;}
  .cluster summary{cursor:pointer; font-weight:950;}
  .qpick{display:flex; align-items:flex-start; gap:10px; padding:9px 6px; border-top:1px solid rgba(15,23,42,.06)}
  .qpick:first-of-type{border-top:none}
  .qpick input{margin-top:3px; transform: scale(1.08)}
  .setupBar{position:sticky; bottom:0; background: rgba(255,255,255,.92); backdrop-filter: blur(6px); border-top:1px solid rgba(15,23,42,.08); padding:12px; margin-top:16px; border-radius:16px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .count{font-weight:950}

  /* Today */
  .progress{height:8px;border-radius:999px;background:rgba(15,23,42,.06);border:1px solid rgba(15,23,42,.08);overflow:hidden;margin-top:10px}
  .progress>div{height:100%; width:0%; background: linear-gradient(90deg, var(--purple2), var(--neon));}

  .promptTop{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-start}
  .promptMeta{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .compare{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px}
  .compare .cell{border:1px solid var(--border); border-radius:16px; padding:12px; background:#fff}
  .compare .lbl{font-size:12px; color: var(--muted2)}
  .compare .val{margin-top:8px; font-weight: 950; letter-spacing:.1px}

  .qbox{margin-top:14px; border:1px solid var(--border); border-radius:18px; padding:16px; background:#fff}
  .question{font-size:19px; margin:0; font-weight: 950; letter-spacing: -0.15px}
  .gap{height: 18px}
  .gap2{height: 18px}

  .options{display:flex; gap:10px; flex-wrap:wrap}
  .opt{flex: 1 1 260px; border:1px solid var(--border); border-radius:16px; padding:11px 12px; background:#fff; cursor:pointer;}
  .opt:hover{border-color: rgba(0,229,255,.55); box-shadow: 0 12px 24px rgba(0,229,255,.08);}
  .opt input{margin-right:8px}
  .textline{width:100%; border:1px solid var(--border); border-radius:16px; padding:12px; background:#fff; color:var(--ink); outline:none; font-size: 15px;}
  .textline::placeholder{color: rgba(75,85,99,.7)}
  .micro{margin-top:0; color: var(--muted); font-size:13.5px; line-height:1.6}

  .btnbar{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:14px}
  .finish{background: var(--good); border-color: var(--goodBorder);}
  .saveNext{background: rgba(91,33,182,.10); border-color: rgba(91,33,182,.35);}
  .center{text-align:center}

  /* Calendar */
  .calTop{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap}
  .calGridHead, .calGrid{display:grid; grid-template-columns:repeat(7,1fr); gap:9px; margin-top:10px}
  .dow{font-size:11px; color: var(--muted2); text-align:center; padding:6px 0}
  .day{border:1px solid var(--border); border-radius:16px; padding:10px; background:#fff; min-height:78px; cursor:pointer; transition: transform .06s ease;}
  .day:hover{transform: translateY(-1px); border-color: rgba(0,229,255,.45);}
  .day.dim{opacity:.40; cursor:default;}
  .day.dim:hover{transform:none; border-color: var(--border);}
  .day .n{display:flex; justify-content:space-between; font-weight:950; font-size:12px}
  .calIcon{border:1px solid rgba(0,0,0,.10); background:rgba(0,0,0,.03); border-radius:12px; padding:4px 8px; font-size:12px; cursor:pointer;}
  .calIcon:active{transform: translateY(1px)}
  .marks{margin-top:9px; display:flex; gap:6px; flex-wrap:wrap}
  .tag{font-size:10px; padding:4px 7px; border-radius:999px; border:1px solid var(--border); background:#fff;}
  .tag.done{border-color: rgba(0,229,255,.55); background: rgba(0,229,255,.08);}
  .tag.fin{border-color: rgba(91,33,182,.35); background: rgba(91,33,182,.06);}
  .tag.ins{border-color: rgba(0,0,0,.12); background: rgba(0,0,0,.03);}

  /* Modal */
  .modal{position:fixed; inset:0; background: rgba(2,6,23,.35); display:none; align-items:center; justify-content:center; padding:18px;}
  .modal.active{display:flex}
  .panel{max-width: 860px; width:100%; background:#fff; border:1px solid rgba(0,0,0,.08); border-radius: 22px; box-shadow: 0 30px 80px rgba(2,6,23,.22);}
  .inner{padding:18px}
  .closeRow{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap}
  textarea{width:100%; min-height:110px; border:1px solid var(--border); border-radius:16px; padding:12px; font-family: inherit; font-size:14px; outline:none;}
  textarea::placeholder{color: rgba(75,85,99,.7)}

  .toast{
    position:fixed;
    left:50%;
    bottom:90px;
    transform:translateX(-50%);
    background:rgba(17,24,39,.95);
    color:#fff;
    padding:10px 14px;
    border-radius:14px;
    font-size:13px;
    max-width:92vw;
    width:max-content;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
    opacity:0;
    pointer-events:none;
    transition:opacity .18s ease, transform .18s ease;
    z-index:9999;
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
  .btnrow.wrap{ flex-wrap:wrap; }
  .cta.secondary{ background:#fff; color:#111827; border:1px solid rgba(17,24,39,.15); }
  @media (max-width:420px){
    .btnrow .cta{ width:100%; }
    .btnrow{ gap:10px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"><span>üîä</span></div>
      <div class="title">
        <h1>zenifyMove</h1>
        <p>A movement awareness engine ‚Ä¢ <b style="color:var(--neon)">Zero AI</b> ‚Ä¢ Offline-first</p>
      </div>
    </div>
    <div class="topnav">
      <button id="navIntro" class="active">Intro</button>
      <button id="navHome">Home</button>
      <button id="navHow">How</button>
      <button id="navSetup">Setup</button>
      <button id="navToday">Today</button>
      <button id="navCalendar">Calendar</button>
      <button id="navInsights">Insights</button></div>
  </header>

  <div class="card"><div class="card-inner">

    <section id="intro" class="screen active">
      <div class="pill">üîí <b>Zero AI</b> ‚Ä¢ Offline-first ‚Ä¢ Private by design</div>

      <div style="height:14px"></div>

      <h2 class="hero-title">A quiet tool to notice<br/>your habits ‚Äî without noise.</h2>

      <p class="hero-sub" style="max-width:60ch">
        One prompt at a time. Health + spending signals. <span class="hand">Self vs self</span>. No hacks, no feeds, no algorithms.
      </p>

      <div style="height:18px"></div>

      <div class="btnrow">
        <button class="cta" id="goHomeBtn">Enter zenifyMove</button>
        <button id="readStoryBtn1" style="border-radius:999px">Founder‚Äôs story</button>
      </div>

      <div style="height:18px"></div>

      <div class="lockline">üîí <span>Everything stays on your device (localStorage). No login. No cloud.</span></div></section>

    <section id="home" class="screen">
      <h2 class="hero-title">The Era of Your Own Intelligence</h2>
      <p class="hero-sub" style="max-width:74ch">
        What works for others often fails us because we‚Äôre unique humans, not algorithms.
        zenifyMove is a quiet space to notice health and money habits without judgement.
      </p>

      <div class="hr"></div>

      <div class="badge">No algorithms ‚Ä¢ Self vs self ‚Ä¢ Private by design</div>
      <p class="subtle" style="margin-top:10px"><b>Progress here is clarity, not numbers.</b></p>

      <div class="btnrow">
        <button class="cta" id="createTrackerBtn">Create My Tracker</button>
      </div>

      <div class="lockline">üîí <span>Stored only on your device.</span></div></section>

    <section id="how" class="screen">
      <h2 style="margin:0">How This Works</h2>
      <p class="hero-sub">Simple. Non-judgmental. One prompt at a time.</p>
      <div class="hr"></div>
      <ol class="list">
        <li>Pick a few questions from habit clusters (morning ‚Üí night).</li>
        <li>Each day, answer at your convenience ‚Äî one prompt per screen.</li>
        <li>You can skip anything. Skipping is allowed.</li>
        <li>You will see <b>Yesterday vs Selected Day</b> ‚Äî that‚Äôs your ‚Äúbefore/after.‚Äù</li>
        <li>Weekly / Monthly / Yearly reflections help you notice patterns.</li>
      </ol>
      <div class="subtle">If you‚Äôre waiting for advice, this app won‚Äôt give it. If you‚Äôre ready to notice yourself, it will stay with you.</div>
      <div class="subtle"><b>Next:</b> Open <b>Setup</b> to choose your questions.</div>
</section>

    <section id="setup" class="screen">
      <div class="setupTop">
        <div>
          <h2 style="margin:0">Tracker Setup</h2>
          <p class="tiny" style="margin:6px 0 0">Pick <b>10‚Äì15</b> to start. You can change anytime. This is not a commitment ‚Äî it‚Äôs a starting set.</p>
        </div>
        <div class="badge" id="selCount">Selected: 0</div>
      </div>

      <div id="setupClusters"></div>

      <div class="setupBar">
        <div class="tiny"><span class="count" id="selCount2">0</span> selected ‚Ä¢ Stored locally</div>
        <div class="rowNav">
          <button id="setupCancelBtn">Save & Exit</button>
          <button class="cta" id="setupDoneBtn">Done ‚Üí Start Today</button>
        </div>
      </div>
    </section>

    <section id="today" class="screen">
      <div class="promptTop">
        <div>
          <div class="badge" id="activeDateChip">Date: ‚Äî</div>
          <div class="subtle" id="activeHint">You don‚Äôt need to answer everything. Skipping is allowed.</div>
        </div>
        <div class="promptMeta">
          <button id="toCalendarBtn">Calendar</button>
          <button id="toInsightsBtn">Insights</button>
          <span class="badge" id="promptIdx">‚Äî</span>
          <span class="badge" id="shiftChip">‚Äî</span>
          <button class="finish" id="finishDayBtn" title="Mark this day as finished">Finish Day</button>
        </div>
      </div>

      <div class="progress"><div id="prog"></div></div>

      <div class="compare">
        <div class="cell">
          <div class="lbl" id="yLbl">Yesterday</div>
          <div class="val" id="yVal">‚Äî</div>
        </div>
        <div class="cell">
          <div class="lbl" id="tLbl">Selected day</div>
          <div class="val" id="tVal">‚Äî</div>
        </div>
      </div>

      <div class="qbox">
        <div class="badge" id="clusterBadge" style="margin-bottom:10px">‚Äî</div>
        <div class="question" id="qText"><span>‚Äî</span></div>

        <div class="gap"></div>
        <div id="resp"></div>

        <div class="gap2"></div>
        <div class="micro" id="micro">‚Äî</div>
      </div>

      <div class="btnbar">
        <div>
          <button id="prev">Back</button>
          <button id="skip">Skip</button>
        </div>
        <div class="rowNav">
          <button class="saveNext" id="saveNextBtn">Save & Next</button>
          <button class="cta" id="next">Next</button>
        </div>
      </div>

      <div class="lockline">üîí <span>Auto-saves. Stored only on your device. No cloud. No logins.</span></div>
    </section>

    <section id="insights" class="screen">
      <h2 style="margin:0">Insights</h2>
      <p class="hero-sub">These are reflection mirrors, not reports. Awareness ‚Üí action (incremental). Compliments included.</p>
      <div class="hr"></div>
      <div class="btnrow">
        <button class="cta" id="openWeekly">Weekly Insight</button>
        <button class="cta" id="openMonthly">Monthly Insight</button>
        <button class="cta" id="openYearly">Yearly Insight</button>
      </div>
      <div class="hr"></div>
      <div class="btnrow">
        <button class="cta secondary" id="quickDownloadWeekly">Download this week</button>
      </div>
      <div class="hr"></div>
      <div class="tiny">Compliment (always): <b>Small difference seen is small difference earned.</b></div>
    </section>


    <section id="calendar" class="screen">
      <div class="calTop">
        <div>
          <h2 style="margin:0">Calendar</h2>
          <p class="tiny" style="margin:6px 0 0">Click any date to open it. You can fill any date later. No penalty.</p>
        </div>
        <div class="btnrow" style="margin:0">
          <button id="calPrev">Prev</button>
          <button id="calNext">Next</button>
          <button id="goTodayFromCal" class="cta">Open Today</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="badge" id="calTitle">Month</div>

      <div class="calGridHead">
        <div class="dow">Sun</div><div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div>
      </div>
      <div class="calGrid" id="calGrid"></div>

      <div class="hr"></div>
      <div class="tiny">Markers: ‚úÖ entries saved ‚Ä¢ ‚ú® Finish Day ‚Ä¢ üóìÔ∏è Saturdays ‚Ä¢ üóìÔ∏è Last Saturday (monthly) ‚Ä¢ üèÅ Dec 31 (yearly)</div>
    </section>

  </div></div>
</div>

<!-- Story modal -->
<div class="modal" id="storyModal" role="dialog" aria-modal="true">
  <div class="panel"><div class="inner">
    <div class="closeRow">
      <div>
        <h3 style="margin:0">Designed for Humans, Not Algorithms.</h3>
        <p class="tiny" style="margin:6px 0 0">You don‚Äôt need more data; you need more awareness.</p>
      </div>
      <button id="closeStory">Close</button>
    </div>
    <div class="hr"></div>
    <p style="margin:0; color:var(--muted); line-height:1.65">
      <b style="color:var(--ink)">The Deep Dive: Why We Chose Human Intelligence Over Artificial Intelligence</b><br/><br/>
      Every day we are flooded with ‚Äúperfect‚Äù wellness routines and financial ‚Äúblueprints‚Äù served by algorithms and social feeds.
      We try to mirror them, only to find they don‚Äôt fit our lives. We end up stuck, overthinking, and feeling like we failed a test we never signed up for.<br/><br/>
      The truth is: what works for a million others won‚Äôt necessarily work for you. We are all unique variables.<br/><br/>
      In a world where so much content is created by AI, we made a conscious choice: <b style="color:var(--ink)">zenifyMove has zero AI.</b><br/><br/>
      This is a quiet, private mirror ‚Äî built to help you notice your own patterns for health and savings, without judgement.
    </p>
    <div class="hr"></div>
    <div class="btnrow" style="justify-content:space-between">
      <div class="tiny">Privacy by design: stored only on your device.</div>
      <button class="cta" id="storyCTA">Start zenifyMove today</button>
    </div>
  </div></div>
</div>

<!-- Insight modals -->
<div class="modal" id="weeklyModal" role="dialog" aria-modal="true">
  <div class="panel"><div class="inner">
    <div class="closeRow">
      <div>
        <h3 style="margin:0">Weekly Awareness Check</h3>
        <p class="tiny" style="margin:6px 0 0">This week wasn‚Äôt about perfection. It was about noticing what quietly moved.</p>
      </div>
      <button data-close="weeklyModal">Close</button>
    </div>
    <div class="hr"></div>
    <ul class="list">
      <li>What quietly improved in my daily habits this week?</li>
      <li>Which small habit felt easier or more natural than before?</li>
      <li>One incremental step I noticed during the week</li>
      <li>What supported me in staying consistent this week?</li>
    </ul>
    <div class="hr"></div>
    <div class="tiny"><b>Compliment:</b> Small difference seen is small difference earned.</div>
    <div class="hr"></div>
    <div class="tiny">Anything I want to record (optional)</div>
    <textarea id="weeklyNote" placeholder="Write one thought you want to remember‚Ä¶"></textarea>
    <div class="btnrow wrap" style="justify-content:flex-end">
      <button class="cta secondary" id="downloadWeekly">Download weekly insight</button>
      <button class="cta" id="saveWeeklyNote">Save</button>
    </div>
  </div></div>
</div>

<div class="modal" id="monthlyModal" role="dialog" aria-modal="true">
  <div class="panel"><div class="inner">
    <div class="closeRow">
      <div>
        <h3 style="margin:0">Monthly Pattern Insight</h3>
        <p class="tiny" style="margin:6px 0 0">Over a month, patterns speak louder than effort. You‚Äôve been collecting signals.</p>
      </div>
      <button data-close="monthlyModal">Close</button>
    </div>
    <div class="hr"></div>
    <ul class="list">
      <li>What patterns did I notice in my habits over this month?</li>
      <li>Which habit had the biggest positive influence on my health or savings?</li>
      <li>What became more conscious or intentional this month?</li>
      <li>One small adjustment I want to carry into the next month</li>
    </ul>
    <div class="hr"></div>
    <div class="tiny"><b>Micro-action:</b> Choose one repeat moment and add a 10-second pause ‚Äî once next week.</div>
    <div class="hr"></div>
    <div class="tiny"><b>Compliment:</b> Small difference seen is small difference earned.</div>
    <div class="hr"></div>
    <div class="tiny">Anything I want to record (optional)</div>
    <textarea id="monthlyNote" placeholder="Write one small pattern you want to keep noticing‚Ä¶"></textarea>
    <div class="btnrow" style="justify-content:flex-end">
      <button class="cta" id="saveMonthlyNote">Save</button>
    </div>
  </div></div>
</div>

<div class="modal" id="yearlyModal1" role="dialog" aria-modal="true">
  <div class="panel"><div class="inner">
    <div class="closeRow">
      <div>
        <h3 style="margin:0">Before You Read Further</h3>
        <p class="tiny" style="margin:6px 0 0">This reflection is not based on how often you used the app. It‚Äôs here for perspective, not judgement.</p>
      </div>
      <button data-close="yearlyModal1">Close</button>
    </div>
    <div class="hr"></div>
    <div class="btnrow" style="justify-content:flex-end">
      <button class="cta" id="yearlyContinue">Continue</button>
    </div>
  </div></div>
</div>

<div class="modal" id="yearlyModal2" role="dialog" aria-modal="true">
  <div class="panel"><div class="inner">
    <div class="closeRow">
      <div>
        <h3 style="margin:0">Yearly Awareness Reflection</h3>
        <p class="tiny" style="margin:6px 0 0">A year is not built by intensity. It‚Äôs built by what you returned to.</p>
      </div>
      <button data-close="yearlyModal2">Close</button>
    </div>
    <div class="hr"></div>
    <ul class="list">
      <li>What did this year teach me about myself through my habits?</li>
      <li>Which habits supported my health and financial stability the most?</li>
      <li>Where did I show quiet consistency, even if it wasn‚Äôt perfect?</li>
      <li>One principle or awareness I want to carry forward into the next year</li>
    </ul>
    <div class="hr"></div>
    <div class="tiny"><b>Compliment:</b> Small difference seen is small difference earned.</div>
    <div class="hr"></div>
    <div class="tiny">Anything I want to record (optional)</div>
    <textarea id="yearlyNote" placeholder="Write one line you want to carry into next year‚Ä¶"></textarea>
    <div class="btnrow" style="justify-content:flex-end">
      <button class="cta" id="saveYearlyNote">Save</button>
    </div>
  </div></div>
</div>

<script>

  // --- Mobile-safe ID globals polyfill (many mobile browsers don't auto-expose #id as window variables)
  (function exposeIdGlobals(){
    document.querySelectorAll('[id]').forEach(el=>{
      if(el && el.id && !(el.id in window)) window[el.id]=el;
    });
  })();

const ALL_PROMPTS = [{"cluster": 1, "title": "CLUSTER 1 ‚Äì HOW MY DAY BEGAN", "q": "On waking up, my body felt‚Ä¶", "type": "options", "options": ["Light / Rested", "Okay but stiff", "Heavy / Tired"], "tip": "Body signals vary daily. This is just today‚Äôs signal."}, {"cluster": 1, "title": "CLUSTER 1 ‚Äì HOW MY DAY BEGAN", "q": "The pace of my morning was‚Ä¶", "type": "options", "options": ["Calm", "Mixed", "Rushed"], "tip": "Rushed mornings are common. Not a failure."}, {"cluster": 1, "title": "CLUSTER 1 ‚Äì HOW MY DAY BEGAN", "q": "The first thing that entered my body was‚Ä¶", "type": "options", "options": ["Water", "Tea / Coffee", "Food", "Nothing"], "tip": "This is awareness, not a health rule."}, {"cluster": 1, "title": "CLUSTER 1 ‚Äì HOW MY DAY BEGAN", "q": "Before breakfast, some movement happened", "type": "options", "options": ["Yes", "No"], "tip": "Movement includes chores, walking, stretching."}, {"cluster": 1, "title": "CLUSTER 1 ‚Äì HOW MY DAY BEGAN", "q": "Before stepping into the day, health crossed my mind", "type": "options", "options": ["Yes", "No"], "tip": "Thinking once is enough."}, {"cluster": 2, "title": "CLUSTER 2 ‚Äì HOW MY BODY MOVED TODAY", "q": "Some intentional movement happened today", "type": "options", "options": ["Yes", "No"], "tip": "Movement looks different for different bodies."}, {"cluster": 2, "title": "CLUSTER 2 ‚Äì HOW MY BODY MOVED TODAY", "q": "The movement felt‚Ä¶", "type": "options", "options": ["Light", "Moderate", "Tiring"], "tip": "Tired is feedback, not failure."}, {"cluster": 2, "title": "CLUSTER 2 ‚Äì HOW MY BODY MOVED TODAY", "q": "My breathing during movement felt‚Ä¶", "type": "options", "options": ["Comfortable", "Slightly strained", "Heavy"], "tip": "Breath matters more than speed."}, {"cluster": 2, "title": "CLUSTER 2 ‚Äì HOW MY BODY MOVED TODAY", "q": "Today‚Äôs body felt more‚Ä¶", "type": "options", "options": ["Flexible", "Same as usual", "Stiff"], "tip": "Stiffness reflects stress or sleep too."}, {"cluster": 2, "title": "CLUSTER 2 ‚Äì HOW MY BODY MOVED TODAY", "q": "I acknowledged my body‚Äôs effort today", "type": "options", "options": ["Yes", "No"], "tip": "Recognition builds consistency."}, {"cluster": 3, "title": "CLUSTER 3 ‚Äì HOW I APPROACHED MY FIRST MEAL", "q": "Breakfast today was mostly‚Ä¶", "type": "options", "options": ["Home-prepared", "Outside / Packed", "Skipped"], "tip": "Skipping is information, not a mistake."}, {"cluster": 3, "title": "CLUSTER 3 ‚Äì HOW I APPROACHED MY FIRST MEAL", "q": "I noticed portion size today", "type": "options", "options": ["Yes", "No"], "tip": "Noticing once is enough."}, {"cluster": 3, "title": "CLUSTER 3 ‚Äì HOW I APPROACHED MY FIRST MEAL", "q": "Oil or sugar awareness crossed my mind", "type": "options", "options": ["Yes", "No"], "tip": "Awareness does not require restriction."}, {"cluster": 3, "title": "CLUSTER 3 ‚Äì HOW I APPROACHED MY FIRST MEAL", "q": "After breakfast, my energy felt‚Ä¶", "type": "options", "options": ["Stable", "Heavy", "Low"], "tip": "Energy response is personal."}, {"cluster": 3, "title": "CLUSTER 3 ‚Äì HOW I APPROACHED MY FIRST MEAL", "q": "I ate without rushing", "type": "options", "options": ["Yes", "No"], "tip": "Rushed meals are common."}, {"cluster": 4, "title": "CLUSTER 4 ‚Äì HOW MONEY SHOWED UP DURING WORK HOURS", "q": "Any unplanned spending happened today", "type": "options", "options": ["Yes", "No"], "tip": "Unplanned doesn‚Äôt mean unnecessary."}, {"cluster": 4, "title": "CLUSTER 4 ‚Äì HOW MONEY SHOWED UP DURING WORK HOURS", "q": "The spend was mostly for‚Ä¶", "type": "options", "options": ["Food / Beverage", "Convenience", "Social / Work"], "tip": "Context matters more than amount."}, {"cluster": 4, "title": "CLUSTER 4 ‚Äì HOW MONEY SHOWED UP DURING WORK HOURS", "q": "This spend felt‚Ä¶", "type": "options", "options": ["Useful", "Neutral", "Avoidable"], "tip": "Neutral spends are normal."}, {"cluster": 4, "title": "CLUSTER 4 ‚Äì HOW MONEY SHOWED UP DURING WORK HOURS", "q": "I paused briefly before spending", "type": "options", "options": ["Yes", "No"], "tip": "A pause is already a win."}, {"cluster": 4, "title": "CLUSTER 4 ‚Äì HOW MONEY SHOWED UP DURING WORK HOURS", "q": "I felt okay about this spend later", "type": "options", "options": ["Yes", "No"], "tip": "Regret is a signal, not a verdict."}, {"cluster": 5, "title": "CLUSTER 5 ‚Äì HOW LUNCH AFFECTED MY DAY", "q": "Lunch today was mostly‚Ä¶", "type": "options", "options": ["Home-prepared", "Outside", "Skipped"], "tip": "Access and schedule matter."}, {"cluster": 5, "title": "CLUSTER 5 ‚Äì HOW LUNCH AFFECTED MY DAY", "q": "Lunch portion felt‚Ä¶", "type": "options", "options": ["Light", "Balanced", "Heavy"], "tip": "Perception is enough."}, {"cluster": 5, "title": "CLUSTER 5 ‚Äì HOW LUNCH AFFECTED MY DAY", "q": "After lunch, my alertness felt‚Ä¶", "type": "options", "options": ["Steady", "Sleepy", "Low"], "tip": "Post-lunch dips are common."}, {"cluster": 5, "title": "CLUSTER 5 ‚Äì HOW LUNCH AFFECTED MY DAY", "q": "I reached for snacks soon after", "type": "options", "options": ["Yes", "No"], "tip": "Snacking reflects energy needs."}, {"cluster": 5, "title": "CLUSTER 5 ‚Äì HOW LUNCH AFFECTED MY DAY", "q": "Lunch supported my workday", "type": "options", "options": ["Yes", "No"], "tip": "Support doesn‚Äôt mean perfection."}, {"cluster": 6, "title": "CLUSTER 6 ‚Äì HOW EMOTIONS & PEOPLE INFLUENCED MY SPENDING", "q": "Spending today was influenced by emotion or people", "type": "options", "options": ["Yes", "No"], "tip": "Family and obligations matter."}, {"cluster": 6, "title": "CLUSTER 6 ‚Äì HOW EMOTIONS & PEOPLE INFLUENCED MY SPENDING", "q": "The main influence felt like‚Ä¶", "type": "options", "options": ["Family need", "Social obligation", "Emotional comfort", "None"], "tip": "Context matters more than control."}, {"cluster": 6, "title": "CLUSTER 6 ‚Äì HOW EMOTIONS & PEOPLE INFLUENCED MY SPENDING", "q": "This spending felt‚Ä¶", "type": "options", "options": ["Meaningful", "Neutral", "Slightly pressured"], "tip": "Pressure is a signal."}, {"cluster": 6, "title": "CLUSTER 6 ‚Äì HOW EMOTIONS & PEOPLE INFLUENCED MY SPENDING", "q": "I felt comfortable saying ‚Äònot now‚Äô today", "type": "options", "options": ["Yes", "No", "Not applicable"], "tip": "Boundaries grow slowly."}, {"cluster": 6, "title": "CLUSTER 6 ‚Äì HOW EMOTIONS & PEOPLE INFLUENCED MY SPENDING", "q": "Looking back, this spend aligns with my values", "type": "options", "options": ["Yes", "Unsure", "No"], "tip": "Uncertainty is allowed."}, {"cluster": 7, "title": "CLUSTER 7 ‚Äì HOW I HANDLED EVENING HUNGER & CRAVINGS", "q": "Evening hunger or cravings showed up today", "type": "options", "options": ["Yes", "No"], "tip": "Cravings reflect fatigue often."}, {"cluster": 7, "title": "CLUSTER 7 ‚Äì HOW I HANDLED EVENING HUNGER & CRAVINGS", "q": "The craving was mostly for‚Ä¶", "type": "options", "options": ["Sweet", "Fried / Salty", "Tea / Coffee", "Nothing specific"], "tip": "This is just noticing."}, {"cluster": 7, "title": "CLUSTER 7 ‚Äì HOW I HANDLED EVENING HUNGER & CRAVINGS", "q": "I paused before acting on the craving", "type": "options", "options": ["Yes", "No"], "tip": "A pause is progress."}, {"cluster": 7, "title": "CLUSTER 7 ‚Äì HOW I HANDLED EVENING HUNGER & CRAVINGS", "q": "What I chose felt‚Ä¶", "type": "options", "options": ["Satisfying", "Neutral", "Slightly heavy"], "tip": "Satisfaction matters more than restriction."}, {"cluster": 7, "title": "CLUSTER 7 ‚Äì HOW I HANDLED EVENING HUNGER & CRAVINGS", "q": "I noticed how my body felt after", "type": "options", "options": ["Yes", "No"], "tip": "Body feedback teaches faster than rules."}, {"cluster": 8, "title": "CLUSTER 8 ‚Äì HOW I PROTECTED MY SAVINGS TODAY", "q": "My savings were respected today", "type": "options", "options": ["Yes", "No", "Not applicable"], "tip": "Auto-savings count, even when unnoticed."}, {"cluster": 8, "title": "CLUSTER 8 ‚Äì HOW I PROTECTED MY SAVINGS TODAY", "q": "Any spend today came from‚Ä¶", "type": "options", "options": ["Planned budget", "Discretionary money", "Savings / buffer"], "tip": "Knowing the source matters more than the amount."}, {"cluster": 8, "title": "CLUSTER 8 ‚Äì HOW I PROTECTED MY SAVINGS TODAY", "q": "I felt at ease with today‚Äôs money choices", "type": "options", "options": ["Yes", "Somewhat", "No"], "tip": "Ease is a strong indicator of discipline."}, {"cluster": 8, "title": "CLUSTER 8 ‚Äì HOW I PROTECTED MY SAVINGS TODAY", "q": "I consciously avoided at least one unnecessary spend", "type": "options", "options": ["Yes", "No", "Didn‚Äôt notice"], "tip": "Avoidance is also an action."}, {"cluster": 8, "title": "CLUSTER 8 ‚Äì HOW I PROTECTED MY SAVINGS TODAY", "q": "Today strengthened my trust in myself with money", "type": "options", "options": ["Yes", "Not sure", "No"], "tip": "Trust builds slowly and unevenly."}, {"cluster": 9, "title": "CLUSTER 9 ‚Äì HOW MY EVENING SUPPORTED REST & HEALTH", "q": "Dinner timing today felt‚Ä¶", "type": "options", "options": ["Earlier than usual", "Around usual time", "Later than usual"], "tip": "Schedules vary across households."}, {"cluster": 9, "title": "CLUSTER 9 ‚Äì HOW MY EVENING SUPPORTED REST & HEALTH", "q": "Dinner portion felt‚Ä¶", "type": "options", "options": ["Light", "Balanced", "Heavy"], "tip": "Perception is enough for awareness."}, {"cluster": 9, "title": "CLUSTER 9 ‚Äì HOW MY EVENING SUPPORTED REST & HEALTH", "q": "After dinner, screen time was‚Ä¶", "type": "options", "options": ["Light", "Moderate", "Heavy"], "tip": "Screens are often used to decompress."}, {"cluster": 9, "title": "CLUSTER 9 ‚Äì HOW MY EVENING SUPPORTED REST & HEALTH", "q": "My body felt ready to rest", "type": "options", "options": ["Yes", "Somewhat", "No"], "tip": "Rest readiness reflects the whole day."}, {"cluster": 9, "title": "CLUSTER 9 ‚Äì HOW MY EVENING SUPPORTED REST & HEALTH", "q": "I allowed myself to slow down tonight", "type": "options", "options": ["Yes", "No"], "tip": "Slowing down is a discipline, not laziness."}, {"cluster": 10, "title": "CLUSTER 10 ‚Äì HOW MY DAY SETTLED", "q": "One thing today that supported my body was‚Ä¶", "type": "text", "placeholder": "One line (optional)", "tip": "Even a small thing counts."}, {"cluster": 10, "title": "CLUSTER 10 ‚Äì HOW MY DAY SETTLED", "q": "One thing today that respected my money was‚Ä¶", "type": "text", "placeholder": "One line (optional)", "tip": "Not spending is also a decision."}, {"cluster": 10, "title": "CLUSTER 10 ‚Äì HOW MY DAY SETTLED", "q": "Did I eat dinner earlier than usual today?", "type": "options", "options": ["Yes", "No", "Not sure"], "tip": "Late dinners happen. Awareness helps more than guilt."}, {"cluster": 10, "title": "CLUSTER 10 ‚Äì HOW MY DAY SETTLED", "q": "How was my screen time after dinner?", "type": "options", "options": ["Minimal", "Moderate", "High"], "tip": "Screens are often used to decompress. This is just noticing."}, {"cluster": 10, "title": "CLUSTER 10 ‚Äì HOW MY DAY SETTLED", "q": "For tomorrow, one intention is‚Ä¶", "type": "text", "placeholder": "Optional", "tip": "Intentions are invitations, not promises."}, {"cluster": 11, "title": "OPTIONAL ‚Äì PURPOSE THROUGH CONTRIBUTION", "q": "Today, did anything I did support or help someone else?", "type": "options", "options": ["Yes, in a small way", "Yes, in a meaningful way", "Not today", "Not sure"], "tip": "Helping doesn‚Äôt have to be visible or dramatic. Even listening or being patient counts."}, {"cluster": 11, "title": "OPTIONAL ‚Äì PURPOSE THROUGH CONTRIBUTION", "q": "If you want to remember it: what was it? (one line)", "type": "text", "placeholder": "Optional", "tip": "This is for remembering, not evaluating."}];

  const promptColors = ["#2e0b5e","#5b21b6","#00e5ff","#0f766e","#111827","#7c3aed","#0891b2","#16a34a"];
  const promptColor = (i) => promptColors[i % promptColors.length];

  const KEYS = {
    onboard:"zenifyMove:onboarded",
    selected:"zenifyMove:selectedQuestions",
    reminders:"zenifyMove:reminders",
    weekNote:(k)=>`zenifyMove:weekNote:${k}`,
    monthNote:(k)=>`zenifyMove:monthNote:${k}`,
    yearNote:(k)=>`zenifyMove:yearNote:${k}`,
    day:(ymd)=>`zenifyMove:day:${ymd}`,
    finish:(ymd)=>`zenifyMove:finish:${ymd}`,
  };

  const pad2 = (n)=>String(n).padStart(2,"0");
  const ymd = (d)=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;

  function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
  function dayKey(d){ return KEYS.day(ymd(d)); }
  function finishKey(d){ return KEYS.finish(ymd(d)); }

  function lsGetJSON(k, fallback) {
    try {
      const v = localStorage.getItem(k);
      return v ? JSON.parse(v) : fallback;
    } catch(e) {
      return fallback;
    }
  }
  function lsSetJSON(k, obj) {
    localStorage.setItem(k, JSON.stringify(obj));
  }

  function loadSelected() {
    return lsGetJSON(KEYS.selected, []);
  }
  function saveSelected(arr) {
    lsSetJSON(KEYS.selected, arr);
  }
  function hasSelected() {
    return loadSelected().length > 0;
  }

  
  // UI helpers (mobile-friendly)
  const toastEl = document.getElementById("toast");
  let toastTimer = null;
  function toast(msg){
    if(!toastEl) return;
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 1800);
  }

  function fmtDate(d){
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
  }

  function getMonday(d){
    const day = d.getDay(); // 0 Sun
    const diff = (day === 0) ? -6 : (1 - day);
    return addDays(d, diff);
  }

  function buildWeeklyExport(monday){
    const start = new Date(monday);
    start.setHours(0,0,0,0);
    const end = addDays(start, 6);
    const weekKey = ymd(start);

    const selected = loadSelected();
    const promptMap = new Map();
    ALL_PROMPTS.forEach((p,i)=> promptMap.set(`q${i}`, p));

    const lines = [];
    lines.push("zenifyMove ‚Äî Weekly Insight");
    lines.push(`Week: ${fmtDate(start)} to ${fmtDate(end)}`);
    lines.push(`Generated: ${new Date().toLocaleString()}`);
    lines.push("----------------------------------------");
    lines.push("");
    lines.push("Weekly Awareness Check");
    lines.push("- What quietly improved in my daily habits this week?");
    lines.push("- Which small habit felt easier or more natural than before?");
    lines.push("- One incremental step I noticed during the week");
    lines.push("- What supported me in staying consistent?");
    lines.push("");
    lines.push("My weekly note:");
    lines.push((JSON.parse(localStorage.getItem("zm_weekly_notes")||"{}")[weekKey]||"").trim() || "(no weekly note saved)");
    lines.push("");
    lines.push("Daily entries");
    lines.push("----------------------------------------");

    const resp = loadResponses();
    for(let d=0; d<7; d++){
      const date = addDays(start, d);
      const key = ymd(date);
      lines.push("");
      lines.push(`${fmtDate(date)} (${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][date.getDay()]})`);
      lines.push("----------------------------------------");

      // prompts answered for this day (only selected)
      let any = false;
      selected.forEach(id=>{
        const p = promptMap.get(id);
        if(!p) return;
        const ans = resp?.[key]?.[id];
        if(ans && String(ans).trim()){
          any = true;
          lines.push(`${p.title}: ${String(ans).trim()}`);
        }
      });
      if(!any) lines.push("(no entries)");
    }

    lines.push("");
    lines.push("‚Äî End ‚Äî");
    return lines.join("\n");
  }

  function downloadText(filename, text){
    try{
      const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1500);
      toast("Downloaded.");
    }catch(e){
      toast("Download not supported on this browser.");
    }
  }

function loadDay(d) {
    return lsGetJSON(dayKey(d), {} );
  }
  function saveDay(d, obj) {
    lsSetJSON(dayKey(d), obj);
  }
  function setVal(d, qid, v) {
    const obj = loadDay(d);
    obj[qid] = v;
    saveDay(d, obj);
  }
  function getValObj(obj, qid) {
    const v = obj[qid];
    return (v===undefined || v===null) ? "" : String(v).trim();
  }
  function countAnswered(obj) {
    return Object.values(obj).filter(v => v!==null && v!==undefined && String(v).trim()!=="").length;
  }
  function isFinished(d) {
    return localStorage.getItem(finishKey(d)) === "true";
  }

  // Navigation
  const screens = ["intro","home","how","setup","today","calendar","insights"];

  // Element lookup (avoid relying on id-to-global behavior; improves mobile-browser compatibility)
  const el = (id) => document.getElementById(id);

  // Navigation
  const navIntro = el("navIntro");
  const navHome = el("navHome");
  const navHow = el("navHow");
  const navSetup = el("navSetup");
  const navToday = el("navToday");
  const navCalendar = el("navCalendar");
  const navInsights = el("navInsights");

  // Common CTAs / controls
  const goHomeBtn = el("goHomeBtn");
  const readStoryBtn1 = el("readStoryBtn1");
  const createTrackerBtn = el("createTrackerBtn");
  const storyCTA = el("storyCTA");
  const closeStory = el("closeStory");

  const saveNextBtn = el("saveNextBtn");
  const prev = el("prev");
  const next = el("next");
  const skip = el("skip");
  const finishDayBtn = el("finishDayBtn");

  // Setup modal
  const setupDoneBtn = el("setupDoneBtn");
  const setupCancelBtn = el("setupCancelBtn");

  // Calendar
  const calPrev = el("calPrev");
  const calNext = el("calNext");
  const goTodayFromCal = el("goTodayFromCal");
  const toInsightsBtn = el("toInsightsBtn");
  const toCalendarBtn = el("toCalendarBtn");

  // Insights / weekly
  const openWeekly = el("openWeekly");
  const openMonthly = el("openMonthly");
  const openYearly = el("openYearly");
  const downloadWeekly = el("downloadWeekly");
  const quickDownloadWeekly = el("quickDownloadWeekly");
  const saveWeeklyNote = el("saveWeeklyNote");
  const saveMonthlyNote = el("saveMonthlyNote");
  const saveYearlyNote = el("saveYearlyNote");
  const yearlyContinue = el("yearlyContinue");
  function show(name){
    screens.forEach(s => document.getElementById(s).classList.remove("active"));
    document.getElementById(name).classList.add("active");
    ["navIntro","navHome","navHow","navSetup","navToday","navCalendar","navInsights"].forEach(id => document.getElementById(id).classList.remove("active"));
    const map={intro:"navIntro",home:"navHome",how:"navHow",setup:"navSetup",today:"navToday",calendar:"navCalendar",insights:"navInsights"};
    document.getElementById(map[name]).classList.add("active");
    if(name==="setup") renderSetup();
    if(name==="today") renderToday();
    if(name==="calendar") renderCalendar();
    if(name==="home") syncHomeButtons();
  }

  navIntro.onclick=()=>show("intro");
  navHome.onclick=()=>show("home");
  navHow.onclick=()=>show("how");
  navSetup.onclick=()=>show("setup");
  navToday.onclick=()=>{ setActiveDate(new Date()); show("today"); };
  navInsights.onclick=()=>show("insights");
  navCalendar.onclick=()=>show("calendar");

  function syncHomeButtons(){ /* Home is minimal in v3 */ }

  goHomeBtn.onclick=()=>show("home");
  readStoryBtn1.onclick=()=>openModal("storyModal");
  createTrackerBtn.onclick=()=>show("setup");

  // Modals
  function openModal(id){ document.getElementById(id).classList.add("active"); }
  function closeModal(id){ document.getElementById(id).classList.remove("active"); }
  closeStory.onclick=()=>closeModal("storyModal");
  storyCTA.onclick=()=>{ closeModal("storyModal"); if(!hasSelected()) show("setup"); else { setActiveDate(new Date()); show("today"); } };
  document.querySelectorAll("[data-close]").forEach(btn=>btn.addEventListener("click", ()=>closeModal(btn.getAttribute("data-close"))));
  document.querySelectorAll(".modal").forEach(m=>m.addEventListener("click",(e)=>{ if(e.target===m) m.classList.remove("active"); }));

  // Setup
  const setupClusters = document.getElementById("setupClusters");
  function renderSetup(){
    const selected = new Set(loadSelected());
    setupClusters.innerHTML = "";

    // group by title (cluster)
    const grouped = new Map();
    ALL_PROMPTS.forEach((p, i)=>{
      const title = p.title;
      if(!grouped.has(title)) grouped.set(title, []);
      grouped.get(title).push({...p, id:`q${i}`, origIndex:i});
    });

    // Render in insertion order
    let first = true;
    grouped.forEach((arr, title)=>{
      const det = document.createElement("details");
      det.className = "cluster";
      det.open = first; first = false;

      const sum = document.createElement("summary");
      sum.textContent = title;
      det.appendChild(sum);

      arr.forEach((q)=>{
        const row = document.createElement("label");
        row.className = "qpick";
        const checked = selected.has(q.id);
        row.innerHTML = `
          <input type="checkbox" data-qid="${q.id}" ${checked ? "checked" : ""} />
          <div>
            <div style="font-weight:950">${q.q}</div>
            <div class="tiny">${q.tip}</div>
          </div>
        `;
        det.appendChild(row);
      });

      setupClusters.appendChild(det);
    });

    function updateCounts(){
      const nowSel = new Set(loadSelected());
      selCount.textContent = `Selected: ${nowSel.size}`;
      selCount2.textContent = String(nowSel.size);
    }
    updateCounts();

    setupClusters.querySelectorAll("input[type=checkbox]").forEach(cb=>{
      cb.onchange = () => {
        const qid = cb.getAttribute("data-qid");
        const cur = new Set(loadSelected());
        if(cb.checked) cur.add(qid); else cur.delete(qid);
        saveSelected(Array.from(cur));
        updateCounts();
        syncHomeButtons();
      };
    });
  }

  setupCancelBtn.onclick=()=>{ localStorage.setItem(KEYS.onboard, "true"); show("home"); };
  setupDoneBtn.onclick=()=>{
    const sel = loadSelected();
    if(sel.length < 1) {
      alert("Select at least 1 question to begin.");
      return;
    }
    localStorage.setItem(KEYS.onboard, "true");
    setActiveDate(new Date());
    show("today");
  };

  // Today
  const activeDateChip = document.getElementById("activeDateChip");
  const activeHint = document.getElementById("activeHint");
  const clusterBadge = document.getElementById("clusterBadge");
  const qSpan = document.getElementById("qText").querySelector("span");
  const resp = document.getElementById("resp");
  const micro = document.getElementById("micro");
  const prog = document.getElementById("prog");
  const promptIdxChip = document.getElementById("promptIdx");
  const shiftChip = document.getElementById("shiftChip");
  const yLbl = document.getElementById("yLbl");
  const tLbl = document.getElementById("tLbl");
  const yVal = document.getElementById("yVal");
  const tVal = document.getElementById("tVal");

  let activeDate = new Date();
  let promptPos = 0;

  function selectedPromptList(){
    const sel = loadSelected();
    const out = [];
    sel.forEach(qid=>{
      const idx = parseInt(qid.slice(1),10);
      if(!Number.isNaN(idx) && ALL_PROMPTS[idx]) out.push({...ALL_PROMPTS[idx], id: qid, origIndex: idx});
    });
    return out;
  }

  function firstUnansweredPos(d){
    const list = selectedPromptList();
    const obj = loadDay(d);
    for(let i=0;i<list.length;i++) {
      const v = getValObj(obj, list[i].id);
      if(!v) return i;
    }
    return 0;
  }

  function setActiveDate(d){
    activeDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    promptPos = firstUnansweredPos(activeDate);
    activeDateChip.textContent = `Date: ${ymd(activeDate)}`;
    const yd = addDays(activeDate,-1);
    yLbl.textContent = `Yesterday (${yd.toLocaleString(undefined,{month:"short"})} ${yd.getDate()})`;
    tLbl.textContent = `Selected day (${activeDate.toLocaleString(undefined,{month:"short"})} ${activeDate.getDate()})`;
    activeHint.textContent = (ymd(activeDate) === ymd(new Date()))
      ? "You are on today. Skipping is allowed."
      : "You are editing a past day from Calendar. Skipping is allowed.";
  }

  function shiftLabel(y,t){
    const ys=(y||"").trim(), ts=(t||"").trim();
    if(!ys && !ts) return "‚Äî";
    if(ys === ts) return "Same";
    if(!ys && ts) return "New today";
    if(ys && !ts) return "Blank today";
    return "Shift";
  }

  function renderToday(){
    const list = selectedPromptList();
    if(list.length === 0) {
      show("setup");
      return;
    }
    if(promptPos < 0) promptPos = 0;
    if(promptPos >= list.length) promptPos = list.length-1;

    const p = list[promptPos];
    const tObj = loadDay(activeDate);
    const yObj = loadDay(addDays(activeDate,-1));

    promptIdxChip.textContent = `Prompt ${promptPos+1} / ${list.length}`;
    prog.style.width = `${Math.round(((promptPos+1)/list.length)*100)}%`;

    clusterBadge.textContent = p.title;
    qSpan.textContent = p.q;
    qSpan.style.color = promptColor(p.origIndex);

    const y = getValObj(yObj, p.id);
    const t = getValObj(tObj, p.id);
    yVal.textContent = y || "‚Äî";
    tVal.textContent = t || "‚Äî";
    shiftChip.textContent = shiftLabel(y,t);

    resp.innerHTML = "";
    if(p.type === "options") {
      const wrap = document.createElement("div");
      wrap.className = "options";
      p.options.forEach((opt,j)=>{
        const id = `r-${p.id}-${j}`;
        const lab = document.createElement("label");
        lab.className = "opt";
        lab.setAttribute("for", id);
        lab.innerHTML = `<input type="radio" id="${id}" name="r" value="${opt}">${opt}`;
        wrap.appendChild(lab);
      });
      resp.appendChild(wrap);
      resp.querySelectorAll("input[type=radio]").forEach(r=>{
        if(r.value === t) r.checked = true;
        r.onchange = () => { setVal(activeDate, p.id, r.value); renderToday(); };
      });
    } else {
      const input = document.createElement("input");
      input.className = "textline";
      input.type = "text";
      input.placeholder = p.placeholder || "Type here (optional)";
      input.value = t;
      input.oninput = () => { setVal(activeDate, p.id, input.value.trim()); };
      input.onblur = () => renderToday();
      resp.appendChild(input);
    }
    micro.textContent = p.tip;

    prev.disabled = (promptPos<=0);
    next.textContent = (promptPos === list.length-1) ? "Done" : "Next";
  }

  prev.onclick = () => { if(promptPos>0){ promptPos--; renderToday(); } };
  skip.onclick = () => {
    const listLen = selectedPromptList().length;
    if(promptPos < listLen-1){ promptPos++; renderToday(); }
    else { alert("End reached. You can finish the day or revisit prompts."); }
  };
  next.onclick = () => {
    const listLen = selectedPromptList().length;
    if(promptPos < listLen-1){ promptPos++; renderToday(); }
    else { alert("Saved. You can return anytime."); }
  };
  saveNextBtn.onclick = () => {
    const listLen = selectedPromptList().length;
    if(promptPos < listLen-1){ promptPos++; renderToday(); }
    else { alert("Saved. You can return anytime."); }
  };

  finishDayBtn.onclick = () => {
    localStorage.setItem(finishKey(activeDate), "true");
    alert("Finish Day marked.");
  };

  toCalendarBtn.onclick = ()=>show("calendar");
  toInsightsBtn.onclick = ()=>show("insights");

  // Calendar
  let calCursor = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
  function isSaturday(d){ return d.getDay()===6; }
  function isLastSaturdayOfMonth(d){
    if(!isSaturday(d)) return false;
    const next = new Date(d); next.setDate(d.getDate()+7);
    return next.getMonth() !== d.getMonth();
  }

  function renderCalendar(){
    const grid = document.getElementById("calGrid");
    if(!grid) return;
    grid.innerHTML = "";

    const y = calCursor.getFullYear();
    const m = calCursor.getMonth();
    calTitle.textContent = `${calCursor.toLocaleString(undefined,{month:"long"})} ${y}`;

    const first = new Date(y,m,1);
    const last = new Date(y,m+1,0);
    const startDow = first.getDay();

    for(let i=0;i<startDow;i++) {
      const blank = document.createElement("div");
      blank.className = "day dim";
      blank.innerHTML = `<div class="n"><span> </span><span></span></div>`;
      grid.appendChild(blank);
    }

    for(let d=1; d<=last.getDate(); d++) {
      const cur = new Date(y,m,d);
      const obj = loadDay(cur);
      const done = countAnswered(obj) > 0;
      const fin = localStorage.getItem(finishKey(cur)) === "true";

      const marks = [];
      if(done) marks.push(`<span class="tag done">‚úÖ</span>`);
      if(fin) marks.push(`<span class="tag fin">‚ú®</span>`);
      if(isSaturday(cur)) marks.push(`<span class="tag ins">üóìÔ∏è</span>`);
      if(isLastSaturdayOfMonth(cur)) marks.push(`<span class="tag ins">üóìÔ∏èM</span>`);
      if(cur.getMonth()===11 && cur.getDate()===31) marks.push(`<span class="tag ins">üèÅ</span>`);

      const cell = document.createElement("div");
      cell.className = "day";
      cell.innerHTML = `
        <div class="n">
          <span>${d}</span>
          <span style="display:flex; gap:8px; align-items:center; justify-content:flex-end;">
            ${isSaturday(cur) ? `<button class="calIcon" data-ins="1" title="Open weekly insight for this Saturday">üóìÔ∏è</button>` : ``}
            <span style="color:rgba(75,85,99,.8)">${cur.toLocaleString(undefined,{weekday:"short"}).slice(0,2)}</span>
          </span>
        </div>
        <div class="marks">${marks.join("")}</div>
      `;
      cell.onclick = () => {
        setActiveDate(cur);
        show("today");
      };

      // Saturday insight shortcut: open Insights only
      const insBtn = cell.querySelector('[data-ins="1"]');
      if(insBtn){
        insBtn.onclick = (e) => {
          e.stopPropagation();
          setActiveDate(cur);
          show("insights");
        };
      }
      grid.appendChild(cell);
    }
  }

  calPrev.onclick = () => { calCursor.setMonth(calCursor.getMonth()-1); renderCalendar(); };
  calNext.onclick = () => { calCursor.setMonth(calCursor.getMonth()+1); renderCalendar(); };
  goTodayFromCal.onclick = () => { setActiveDate(new Date()); show("today"); };

  // Insights
  openWeekly.onclick = () => {
    openModal("weeklyModal");
    const d = new Date(activeDate);
    const day = d.getDay(); // 0 Sun
    const diff = (day === 0) ? -6 : (1 - day); // Monday start
    const monday = addDays(d, diff);
    const key = ymd(monday);
    weeklyNote.value = localStorage.getItem(KEYS.weekNote(key)) || "";
    weeklyNote.setAttribute("data-key", key);
  };
  saveWeeklyNote.onclick = () => {
    const k = weeklyNote.getAttribute("data-key") || ymd(new Date());
    localStorage.setItem(KEYS.weekNote(k), weeklyNote.value.trim());
    toast("Saved.");
  };

  function downloadCurrentWeek(){
    const base = activeDate || new Date();
    const monday = getMonday(base);
    const exp = buildWeeklyExport(monday);
    const fn = `zenifyMove_week_${exp.key}.txt`;
    downloadText(fn, exp.text);
  }

  // Download CTAs
  if(typeof downloadWeekly !== "undefined" && downloadWeekly){
    downloadWeekly.onclick = downloadCurrentWeek;
  }
  if(typeof quickDownloadWeekly !== "undefined" && quickDownloadWeekly){
    quickDownloadWeekly.onclick = () => { show("insights"); downloadCurrentWeek(); };
  }


  openMonthly.onclick = () => {
    openModal("monthlyModal");
    const key = `${activeDate.getFullYear()}-${pad2(activeDate.getMonth()+1)}`;
    monthlyNote.value = localStorage.getItem(KEYS.monthNote(key)) || "";
    monthlyNote.setAttribute("data-key", key);
  };
  saveMonthlyNote.onclick = () => {
    const k = monthlyNote.getAttribute("data-key") || `${new Date().getFullYear()}-${pad2(new Date().getMonth()+1)}`;
    localStorage.setItem(KEYS.monthNote(k), monthlyNote.value.trim());
    toast("Saved.");
  };

  openYearly.onclick = () => {
    openModal("yearlyModal1");
  };
  yearlyContinue.onclick = () => {
    closeModal("yearlyModal1");
    openModal("yearlyModal2");
    const key = String(activeDate.getFullYear());
    yearlyNote.value = localStorage.getItem(KEYS.yearNote(key)) || "";
    yearlyNote.setAttribute("data-key", key);
  };
  saveYearlyNote.onclick = () => {
    const k = yearlyNote.getAttribute("data-key") || String(new Date().getFullYear());
    localStorage.setItem(KEYS.yearNote(k), yearlyNote.value.trim());
    toast("Saved.");
  };

  // Boot
  (function init(){
    syncHomeButtons();
    const onboarded = localStorage.getItem(KEYS.onboard) === "true";
    if(!onboarded) show("intro");
    else show("home");
    setActiveDate(new Date());
    renderCalendar();
    bindRem();
  })();

</script>

<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
